# BoringChatBot
无聊机器人


## 使用 Alembic 生成数据表
1. pip install alembic psycopg2-binary sqlalchemy
2. 关联数据表db_model.py 和 alembic.ini 和 alembic、alembic/env.py
3. 使用 pgAdmin 工具创建 boring_chatbot 数据表
4. alembic init alembic
5. 生成迁移文件 
    
   alembic revision --autogenerate -m "create files table"
6. 应用迁移 
 
   alembic upgrade head
## 更新表单，增加字段status

       class File(FileBase, table=True):

          status: str = Field(nullable=True, default=FileStatus.LOADING.value, max_length=16)
   
   alembic revision --autogenerate -m "add status field to files"
   
   如果想要已有数据表中status这一列不为null,可以在生成的迁移文件中修改upgrade函数

       def upgrade() -> None:
           """Upgrade schema."""
           # ### commands auto generated by Alembic - please adjust! ###
           op.alter_column('files', 'status',
               existing_type=sa.VARCHAR(length=16),
               nullable=True)
           # 给已有数据赋默认值
           op.execute("UPDATE \"files\" SET status = 'COMPLETE' WHERE status IS NULL")

           # 最后改成非空约束
           op.alter_column("files", "status", nullable=False)
   
   alembic upgrade head